# 5. The Cognitive Probes

**Module:** `nexus_tools/cmd_probes.py`
**Nexus Commands:** `plan`, `probe`

## Purpose

The Cognitive Probes (`plan` and `probe`) are powerful debugging tools that allow you to emulate parts of the system's cognitive cycle in an isolated environment. They provide a way to test the logic of individual services without running the main `main.py` server.

> ⚠️ **Requirements:** The `plan` and `probe` commands emulate real-time cognitive processes. To use them, you must:
>
> 1.  Have the complete project source code, including all cognitive services.
> 2.  Ensure network access to a running LLM server (e.g., vLLM), with the address configured in the project settings.

## `plan` Command

The `plan` probe tests the first crucial part of the cognitive cycle: **Instinct -> Enrichment Plan**. It shows how the system initially reacts to a user query and what search queries it formulates to access its long-term memory.

### Usage

```
[NEXUS]> plan "<impulse_text>"
```

-   `<impulse_text>`: The user query text to test. Be sure to use quotes if it contains spaces.

### Understanding the Output

The `plan` command's output demonstrates a step-by-step analysis of your query:

1.  **`STEP 1: Instinct Generation`**:
    -   **What it is:** A quick, "instinctive" response generated by `SimpleExecutorService`. This is the system's first thought, without consulting its memory.
    -   **Why it's useful:** It allows you to assess the model's basic understanding of the query.

2.  **`STEP 2: Enrichment Planning`**:
    -   **What it is:** The final JSON plan created by `EnrichmentPlannerService`. Here you can see the structured search queries (`semantic_query`) and extracted concepts (`concepts`).
    -   **Why it's useful:** This is the "brain" of the operation. You can see *exactly what* the system intends to look for in its long-term memory to enrich its answer.

3.  **`NEXT STEP: Probe Memory`**:
    -   **What it is:** At the end of its output, the `plan` command generates a ready-to-use `probe --plan-json '...'` command containing the newly created JSON plan.
    -   **Why it's useful:** You can copy this command and execute it immediately to test how `MemoryRecallService` will perform with that specific plan, linking the two probes into a seamless debugging workflow.

## `probe` Command

The `probe` command is a versatile tool for testing the entire cognitive cycle from planning to final synthesis, offering several modes for fine-grained debugging.

### Usage

```
[NEXUS]> probe "<impulse_text>" [options]
[NEXUS]> probe --plan-json "<json_plan>" [options]
```

### Modes and Options

**1. Full Cycle Emulation**
This is the default mode. It simulates the entire request processing chain.
```
[NEXUS]> probe "remind me about coffee and what is the capital of Brazil"
```
-   **What happens:** The system sequentially executes: Instinct -> Enrichment Plan -> Memory Recall -> Final Synthesis. You will see a step-by-step log of each stage's output.

**2. Emulation without Synthesis (`--no-synth`)**
This mode stops the cycle after memory recall, allowing you to analyze *what* the system found.
```
[NEXUS]> probe "remind me about coffee" --no-synth
```
-   **What happens:** The cycle runs through Instinct -> Plan -> Recall. The output will show the generated plan and the list of nodes retrieved from memory, along with their relevance scores.
-   **When to use:** Ideal for debugging `MemoryRecallService` and tuning the ranking weights.

**3. Testing with a Manual Plan (`--plan-json`)**
The most advanced mode. It allows you to skip the planning stage and feed a custom, pre-made JSON plan directly to the memory recall service.
```
[NEXUS]> probe --plan-json '{"queries": [{"semantic_query": "coffee recipe", "concepts": ["coffee", "recipe"]}]}'
```
-   **What happens:** The system immediately proceeds to the Memory Recall stage, using your JSON.
-   **When to use:** For "surgical" testing of the recall mechanism. You can take a plan generated by the `plan` command, modify it, and check how `MemoryRecallService` responds to the altered queries.
