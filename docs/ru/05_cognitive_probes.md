# 5. Когнитивные Зонды

**Модуль:** `nexus_tools/cmd_probes.py`
**Команды в `Nexus`:** `plan`, `probe`

## Назначение

Когнитивные зонды (`plan` и `probe`) — это мощные инструменты для отладки, позволяющие эмулировать части когнитивного цикла системы в изолированной среде. Они дают возможность протестировать логику отдельных сервисов, не запуская основной сервер `main.py`.

> ⚠️ Требования: Команды `plan` и `probe` эмулируют когнитивные процессы в реальном времени. Для их работы необходимо:
>
>    1. Иметь полный код проекта, включая все когнитивные сервисы.
>    2. Обеспечить сетевой доступ к работающему LLM-серверу (например, vLLM), адрес которого указан в файле конфигурации.

## Команда `plan`

Зонд `plan` позволяет протестировать первую, самую важную часть когнитивного цикла: **"Инстинкт -> План Обогащения"**. Он показывает, как система реагирует на запрос пользователя и какие поисковые запросы она формирует для обращения к своей памяти.

### Использование

```
[NEXUS]> plan "<ТекстИмпульса>"
```

-   `<ТекстИмпульса>`: Текст запроса пользователя, который вы хотите протестировать. Обязательно заключайте в кавычки.

### Что показывает результат?

Вывод команды `plan` пошагово демонстрирует, как система анализирует ваш запрос:

1.  **`STEP 1: Instinct Generation`**:
    *   **Что это:** Быстрый, "инстинктивный" ответ, сгенерированный `SimpleExecutorService`. Это то, что система "подумала" в первую очередь, не заглядывая в память.
    *   **Зачем это нужно:** Позволяет оценить базовое понимание запроса моделью.

2.  **`STEP 2: Enrichment Planning`**:
    *   **Что это:** Финальный JSON-план, созданный `EnrichmentPlannerService`. Здесь вы видите структурированные поисковые запросы (`semantic_query`) и извлеченные концепты (`concepts`).
    *   **Зачем это нужно:** Это "мозг" операции. Вы видите, *что именно* система собирается искать в своей долговременной памяти для обогащения ответа.

3.  **`NEXT STEP: Probe Memory`**:
    *   **Что это:** В конце вывода `plan` генерирует готовую команду `probe --plan-json '...'`, содержащую созданный JSON-план.
    *   **Зачем это нужно:** Вы можете скопировать эту команду и сразу же выполнить ее, чтобы протестировать, как `MemoryRecallService` отработает с этим конкретным планом. Это связывает два зонда в единый рабочий процесс отладки.

## Команда `probe`

Зонд `probe` — это универсальный инструмент для тестирования всего когнитивного цикла от планирования до финального синтеза. Он имеет несколько режимов работы для тонкой отладки.

### Использование

```
[NEXUS]> probe "<ТекстИмпульса>" [опции]
[NEXUS]> probe --plan-json "<JSON-план>" [опции]
```

### Режимы и Опции

**1. Полная эмуляция цикла**
Это режим по умолчанию. Он имитирует всю цепочку обработки запроса.
```
[NEXUS]> probe "напомни про кофе и какая столица у бразилии"
```
-   **Что происходит:** Последовательно выполняются шаги: Инстинкт -> План Обогащения -> Поиск в Памяти -> Финальный Синтез. Вы увидите пошаговый вывод работы каждого этапа.

**2. Эмуляция до этапа синтеза (`--no-synth`)**
Этот режим позволяет остановить цикл после поиска в памяти, чтобы проанализировать, *что именно* система нашла.
```
[NEXUS]> probe "напомни про кофе" --no-synth
```
-   **Что происходит:** Выполняются шаги: Инстинкт -> План -> Поиск. Вывод покажет вам сгенерированный план и список узлов, найденных в памяти, вместе с их очками релевантности.
-   **Когда использовать:** Идеально для отладки `MemoryRecallService` и тюнинга весов ранжирования.

**3. Тестирование с ручным планом (`--plan-json`)**
Самый продвинутый режим. Позволяет пропустить этап планирования и "скормить" сервису поиска в памяти свой собственный, заранее подготовленный JSON-план.
```
[NEXUS]> probe --plan-json '{"queries": [{"semantic_query": "рецепт кофе", "concepts": ["кофе", "рецепт"]}]}'
```
-   **Что происходит:** Система сразу переходит к шагу "Поиск в Памяти", используя ваш JSON.
-   **Когда использовать:** Для "хирургического" тестирования поиска. Вы можете взять план, сгенерированный командой `plan`, модифицировать его и проверить, как `MemoryRecallService` отреагирует на измененные запросы.
