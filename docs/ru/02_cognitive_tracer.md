# 2. Когнитивный Трейсер

**Модуль:** `nexus_tools/cmd_trace.py`
**Команда в `Nexus`:** `trace` (алиас: `tr`)

## Назначение

Когнитивный Трейсер — это инструмент для отладки, который отвечает на вопрос: **"Как именно система обработала этот запрос?"**. Он реконструирует и визуализирует в виде дерева всю последовательность операций (задач и отчетов), связанных с одним конкретным "импульсом" пользователя.

## Использование

```
[NEXUS]> trace <ID_узла>
```

-   `<ID_узла>`: Полный или частичный ID начального узла, обычно `UserImpulse` или `FinalResponseNode`.

## Что показывает результат?

Результат работы — это цветное ASCII-дерево, которое показывает иерархию и последовательность когнитивных актов.

**Пример для нового когнитивного цикла:**

```
TRACE: Tracing cognitive chain for ID starting with '67b6575e'...
--------------------------------------------------------------------------------
[ 67b6575e ] UserImpulse                          : приветик!
├─> [ 819ed939 ] TaskNode                             : {"original_impulse": "приветик!", "instinctive_response": "З...
│   └─> [ 1cd57c52 ] ReportNode                           : {"queries": [{"semantic_query": "какой любимый цвет пользова...
│       └─> [ 4376a050 ] SearchPlanNode                       : {"queries": [{"semantic_query": "какой любимый цвет пользова...
│           ├─> [ 375feb83 ] TaskNode                             : {"request_payload": {"semantic_query": "объяснение процесса ...
│           │   └─> [ 08a6df7f ] ReportNode                           : {"found_nodes": [{"type": "UserImpulse", "content": "привети...
│           └─> [ ba2bb654 ] TaskNode                             : {"request_payload": {"semantic_query": "какой любимый цвет п...
│               └─> [ 2dff91c9 ] ReportNode                           : {"found_nodes": [{"type": "UserImpulse", "content": "привети...
├─> [ 84bdda29 ] InstinctiveResponseNode              : Здравствуйте! Чем я могу вам помочь сегодня?
├─> [ 95dbc510 ] TaskNode                             : {"impulse_text": "приветик!", "history": []}
│   └─> [ 0ec0e8ab ] ReportNode                           : {"text": "Здравствуйте! Чем я могу вам помочь сегодня?"}
├─> [ a8ac5491 ] FinalResponseNode                : Здравствуйте! Я всегда рада вам помочь. Как я могу быть вам ...
└─> [ e9f140bd ] TaskNode                             : {"original_impulse": "приветик!", "instinctive_response": "З...
    └─> [ a8545ab8 ] ReportNode                           : {"text": "Здравствуйте! Я всегда рада вам помочь. Как я могу...
        └─> ↪ (link to already shown FinalResponseNode [a8ac5491])
--------------------------------------------------------------------------------
END TRACE
```

### Как читать дерево:

-   **`[ ID_узла ]`**: Уникальный идентификатор шага (узла в памяти).
-   **`ТипУзла`**: Роль этого шага в процессе. Цвет типа узла соответствует его семантической роли (зеленый - взаимодействие с пользователем, голубой - задачи, желтый - отчеты).
-   **`:` (двоеточие)**: Краткое содержание узла.
-   **`└─>` и `├─>`**: Указывают на дочерние процессы. Например, `TaskNode` порождает `ReportNode`.
-   **`↪ (link to ...)`**: Обозначает ссылку на узел, который уже был показан выше в дереве, чтобы избежать дублирования.

Трейсер намеренно следует только по "процессным" ребрам графа (таким как `IS_RESULT_OF`, `IS_TASK_FOR`), игнорируя чисто семантические связи (например, `CONTAINS_CONCEPT`). Это позволяет отфильтровать "шум" и показать именно **операционную логику** — как система думает, а не всё, что она знает по теме.
