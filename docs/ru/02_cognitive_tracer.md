# 2. Когнитивный Трейсер

**Модуль:** `nexus_tools/cmd_trace.py`
**Команда в `Nexus`:** `trace` (алиас: `tr`)

## Назначение

Трейсер отвечает на главный вопрос отладки: **"Как система пришла к этому выводу?"**. Он визуализирует всю "мыслительную цепочку" — последовательность шагов (узлов в памяти), которые были выполнены для обработки одного запроса пользователя.

## Использование

```
[NEXUS]> trace <ID_узла>
```
-   `<ID_узла>`: Полный или частичный ID начального узла, обычно `UserImpulse` или `FinalResponseNode`.

## Что показывает результат?

Результат работы — это цветное ASCII-дерево, которое показывает иерархию и последовательность когнитивных актов.

**Пример для нового когнитивного цикла:**
```
TRACE: Tracing cognitive chain for ID starting with '73930751'...
--------------------------------------------------------------------------------
[ 73930751 ] UserImpulse                          : расскажи про фотосинтез
├─> [ 204f00eb ] TaskNode                             : {"original_impulse": "расскажи про фотосинтез", "instinctive...
│   └─> [ c80b960a ] ReportNode                           : {"text": "Фотосинтез - это природный процесс, который позвол...
│       └─> [ 211ca6b4 ] FinalResponseNode                : Фотосинтез - это природный процесс, который позволяет растен...
├─> (link to FinalResponseNode [211ca6b4])
├─> [ 857c8c2c ] InstinctiveResponseNode              : Фотосинтез - это процесс, который позволяет растениям, а так...
├─> [ a6df850d ] TaskNode                             : {"original_impulse": "расскажи про фотосинтез"}
│   └─> [ df97d109 ] ReportNode                           : {"queries": [{"semantic_query": "расскажи про фотосинтез", "...
│       └─> [ e3eb08d4 ] SearchPlanNode                       : {"queries": [{"semantic_query": "расскажи про фотосинтез", "...
│           └─> [ 53f072e5 ] TaskNode                             : {"request_payload": {"semantic_query": "расскажи про фотосин...
│               └─> [ 9ecc6d10 ] ReportNode                           : {"found_nodes": [{"type": "KnowledgeCrystalNode", "content":...
└─> [ c027ec38 ] TaskNode                             : {"impulse_text": "расскажи про фотосинтез", "history": [{"ro...
    └─> [ 77ae53bb ] ReportNode                           : {"text": "Фотосинтез - это процесс, который позволяет растен...
--------------------------------------------------------------------------------
END TRACE
```

### Как читать дерево:
-   **`[ ID_узла ]`**: Уникальный идентификатор шага (узла в памяти).
-   **`ТипУзла`**: Роль этого шага в процессе. Цвет типа узла соответствует его семантической роли (зеленый - взаимодействие с пользователем, голубой - задачи, желтый - отчеты).
-   **`:` (двоеточие)**: Краткое содержание узла.
-   **`└─>` и `├─>`**: Указывают на дочерние процессы. Например, `TaskNode` порождает `ReportNode`.

Трейсер следует только по **"процессным" связям** (таким как `IS_RESULT_OF`, `IS_TASK_FOR`, `WAS_SYNTHESIZED_FROM` и т.д.), игнорируя семантические связи (например, `CONTAINS_CONCEPT`), чтобы показать именно **операционную логику** системы, а не все связанные данные.
